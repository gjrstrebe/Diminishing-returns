<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drywall Productivity Comparison (Muddskip)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc;
        }
        .tooltip {
            position: absolute;
            text-align: left;
            padding: 10px 15px;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid #3b82f6; /* Blue border for emphasis */
            border-radius: 8px;
            pointer-events: none;
            opacity: 0;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
            transition: opacity 0.2s;
            z-index: 10;
        }
        .hotmud-line {
            fill: none;
            stroke: #dc2626; /* Red-600 */
            stroke-width: 4px;
            stroke-linecap: round;
        }
        .muddskip-line {
            fill: none;
            stroke: #3b82f6; /* Blue-500 */
            stroke-width: 4px;
            stroke-dasharray: 0; /* Solid line */
            stroke-linecap: round;
        }
        .focus-circle {
            transition: opacity 0.1s;
        }
        .marginal-line {
            stroke-width: 2px;
            stroke-dasharray: 2 2;
            pointer-events: none;
            opacity: 0;
        }
        .marginal-hotmud { stroke: #f87171; }
        .marginal-muddskip { stroke: #93c5fd; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-5xl mx-auto bg-white p-6 md:p-10 rounded-xl shadow-2xl">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">Drywall Productivity Comparison: Scale & Tool Compatibility</h1>
        <p class="text-gray-600 mb-8">Comparing traditional fast-setting mud (Hotmud) with the continuous-process additive (Muddskip).</p>

        <div id="chart-container" class="w-full aspect-[16/9] relative">
            <svg id="productivity-chart" class="w-full h-full"></svg>
        </div>

        <!-- Legend and Explanations -->
        <div class="mt-10">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Conclusion on Scaling:</h2>
            <div class="flex flex-col md:flex-row gap-6">
                <!-- Hotmud Explanation -->
                <div class="flex-1 p-5 bg-red-50 rounded-lg border-l-4 border-red-600 shadow-sm">
                    <div class="flex items-center mb-2">
                        <div class="w-8 h-1 bg-red-600 rounded mr-3"></div>
                        <p class="font-bold text-red-800">Hotmud (Fast-Setting Mud)</p>
                    </div>
                    <p class="text-sm text-red-700">
                        **Severe Diminishing Returns:** Ideal only for small tasks (patching, corners). Beyond **30% project scale**, the need to rush, clean mixers, and dispose of setting mud completely negates the benefit, making it unviable for large-scale production or use in specialized continuous-flow tools.
                    </p>
                </div>

                <!-- Muddskip Explanation -->
                <div class="flex-1 p-5 bg-blue-50 rounded-lg border-l-4 border-blue-600 shadow-sm">
                    <div class="flex items-center mb-2">
                        <div class="w-8 h-1 bg-blue-600 rounded mr-3"></div>
                        <p class="font-bold text-blue-800">Muddskip (Wet-on-Wet Additive)</p>
                    </div>
                    <p class="text-sm text-blue-700">
                        **Sustained Linear Returns:** Eliminates the set-time constraint, allowing workers to maintain high productivity regardless of scale. **Critical advantage:** It enables the use of efficient, large-capacity production tools, maintaining a high marginal gain and reaching a much higher overall output ceiling.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            function drawChart() {
                d3.select("#productivity-chart").selectAll("*").remove();

                const container = document.getElementById('chart-container');
                const width = container.clientWidth;
                const height = container.clientHeight;

                const margin = { top: 20, right: 30, bottom: 50, left: 60 };

                const innerWidth = width - margin.left - margin.right;
                const innerHeight = height - margin.top - margin.bottom;

                const svg = d3.select("#productivity-chart")
                    .attr("viewBox", `0 0 ${width} ${height}`)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

                const maxProject = 100;
                const maxProductivity = 100;

                // 1. Data Generation
                const data = [];
                for (let i = 0; i <= maxProject; i++) {
                    const normalizedInput = i / maxProject;
                    
                    // --- Hotmud Model (Severe, early Diminishing Returns) ---
                    // Aggressive exponential decay. Output stalls significantly early (around 30-40% scale)
                    let hotmudOutput = maxProductivity * (1 - Math.exp(-9 * normalizedInput));
                    hotmudOutput = Math.min(65, hotmudOutput); // Cap hotmud productivity ceiling at 65% visually
                    
                    // --- Muddskip Model (Near-Linear, higher overall ceiling due to tool compatibility) ---
                    let muddskipOutput = maxProductivity * (0.1 + 0.9 * normalizedInput * (1 + 0.1 * normalizedInput));
                    muddskipOutput = Math.min(maxProductivity + 10, muddskipOutput); // Allow it to slightly exceed 100% max input for visual 'production tool' effect

                    data.push({
                        projectSize: i,
                        hotmud: hotmudOutput,
                        muddskip: muddskipOutput
                    });
                }
                
                // 2. Define Scales
                const x = d3.scaleLinear()
                    .domain([0, maxProject])
                    .range([0, innerWidth]);

                const y = d3.scaleLinear()
                    .domain([0, maxProductivity + 10]) // Adjusted max Y-axis for Muddskip's higher ceiling
                    .range([innerHeight, 0]);

                // 3. Draw Axes
                svg.append("g")
                    .attr("transform", `translate(0,${innerHeight})`)
                    .call(d3.axisBottom(x).ticks(5).tickFormat(d => d === 100 ? "Large Scale (Tools)" : d === 0 ? "Patching" : `${d}%`))
                    .attr("class", "text-sm text-gray-500");

                svg.append("g")
                    .call(d3.axisLeft(y).ticks(6).tickFormat(d => `${d}%`))
                    .attr("class", "text-sm text-gray-500");

                // X-Axis Label
                svg.append("text")
                    .attr("text-anchor", "middle")
                    .attr("x", innerWidth / 2)
                    .attr("y", innerHeight + margin.bottom - 5)
                    .attr("class", "font-medium text-gray-700 text-base")
                    .text("Project Scale (Drywall Linear Footage)");

                // Y-Axis Label
                svg.append("text")
                    .attr("text-anchor", "middle")
                    .attr("transform", `translate(${-margin.left + 15},${innerHeight / 2}) rotate(-90)`)
                    .attr("class", "font-medium text-gray-700 text-base")
                    .text("Relative Productivity / Total Output (%)");

                // --- Production Tool Threshold Line ---
                const productionToolX = x(40); // Visually mark the point where Hotmud stalls and production tools become relevant
                svg.append("line")
                    .attr("x1", productionToolX)
                    .attr("y1", y(maxProductivity + 10))
                    .attr("x2", productionToolX)
                    .attr("y2", innerHeight)
                    .attr("stroke", "#6b7280")
                    .attr("stroke-dasharray", "4 4")
                    .attr("stroke-width", 1);
                
                svg.append("text")
                    .attr("x", productionToolX)
                    .attr("y", y(maxProductivity + 10) - 5)
                    .attr("text-anchor", "middle")
                    .attr("class", "text-xs font-semibold text-gray-700 bg-white px-1 rounded-sm")
                    .text("Production Tool Threshold");


                // 4. Draw the Lines
                const lineHotmud = d3.line()
                    .x(d => x(d.projectSize))
                    .y(d => y(d.hotmud))
                    .curve(d3.curveMonotoneX);

                const lineMuddskip = d3.line()
                    .x(d => x(d.projectSize))
                    .y(d => y(d.muddskip))
                    .curve(d3.curveMonotoneX);

                svg.append("path")
                    .datum(data)
                    .attr("class", "hotmud-line")
                    .attr("d", lineHotmud);

                svg.append("path")
                    .datum(data)
                    .attr("class", "muddskip-line")
                    .attr("d", lineMuddskip);

                // --- Interaction Setup ---

                const tooltip = d3.select("body").append("div")
                    .attr("class", "tooltip");
                    
                const focus = svg.append("g").style("opacity", 0);

                // Focus circles
                focus.append("circle").attr("class", "focus-circle hotmud-focus-circle").attr("r", 6).attr("fill", "#dc2626");
                focus.append("circle").attr("class", "focus-circle muddskip-focus-circle").attr("r", 6).attr("fill", "#3b82f6");
                
                // Vertical focus line
                focus.append("line").attr("class", "marginal-line focus-vline").attr("y1", 0).attr("y2", innerHeight).attr("stroke", "#94a3b8");

                // Hover overlay area
                svg.append("rect")
                    .attr("width", innerWidth)
                    .attr("height", innerHeight)
                    .style("fill", "none")
                    .style("pointer-events", "all")
                    .on("mouseover", () => focus.style("opacity", 1))
                    .on("mouseout", () => focus.style("opacity", 0) & tooltip.style("opacity", 0))
                    .on("mousemove", mousemove);

                function mousemove(event) {
                    const [mx] = d3.pointer(event);
                    const projectSize = x.invert(mx);
                    
                    const i = Math.round(projectSize);
                    const d = data.find(p => p.projectSize === i);

                    if (!d) return;

                    // Update Focus Elements
                    const hotmudY = y(d.hotmud);
                    const muddskipY = y(d.muddskip);

                    focus.select(".hotmud-focus-circle").attr("cx", x(d.projectSize)).attr("cy", hotmudY);
                    focus.select(".muddskip-focus-circle").attr("cx", x(d.projectSize)).attr("cy", muddskipY);
                    focus.select(".focus-vline").attr("x1", x(d.projectSize)).attr("x2", x(d.projectSize));
                    
                    // Calculate marginal gain (approximation)
                    const prev_d = data.find(p => p.projectSize === i - 1);
                    const hotmud_marginal = prev_d ? (d.hotmud - prev_d.hotmud).toFixed(2) : d.hotmud.toFixed(2);
                    const muddskip_marginal = prev_d ? (d.muddskip - prev_d.muddskip).toFixed(2) : d.muddskip.toFixed(2);
                    
                    // Determine which material is more productive at this scale
                    const muddskipWins = d.muddskip > d.hotmud;

                    // Determine Marginal Gain Description
                    let hotmudMarginalText = '';
                    if (hotmud_marginal < 0.1) {
                        hotmudMarginalText = '<span class="text-red-700 font-bold">~0.0% (Stalled)</span>';
                    } else if (hotmud_marginal < 0.5) {
                        hotmudMarginalText = `<span class="text-yellow-700 font-bold">${hotmud_marginal}% (Minimal)</span>`;
                    } else {
                        hotmudMarginalText = `<span class="text-red-700 font-bold">${hotmud_marginal}%</span>`;
                    }


                    // Update Tooltip
                    tooltip.html(`
                        <p class="font-bold text-lg mb-1">Scale: ${d.projectSize.toFixed(0)}%</p>
                        <hr class="my-1 border-gray-300">
                        <div class="flex justify-between items-start text-red-800">
                            <span>Hotmud Output:</span> 
                            <span class="font-bold text-right">${d.hotmud.toFixed(1)}%</span>
                        </div>
                        <div class="flex justify-between items-start text-red-800 mb-2">
                            <span>Marginal Gain:</span> 
                            ${hotmudMarginalText}
                        </div>
                        <div class="flex justify-between items-start text-blue-800">
                            <span>Muddskip Output:</span> 
                            <span class="font-bold text-right">${d.muddskip.toFixed(1)}%</span>
                        </div>
                        <div class="flex justify-between items-start text-blue-800">
                            <span>Marginal Gain:</span> 
                            <span class="text-blue-700 font-bold">${muddskip_marginal}%</span>
                        </div>
                        <hr class="my-1 border-gray-300">
                        <p class="mt-2 text-sm ${muddskipWins ? 'text-blue-600' : 'text-red-600'}">
                            ${muddskipWins ? 'Muddskip is significantly more efficient at this scale.' : 'Hotmud has a slight speed advantage only for very small tasks.'}
                        </p>
                    `)
                    .style("left", (event.pageX + 15) + "px")
                    .style("top", (event.pageY - 120) + "px")
                    .style("opacity", 1);
                }
            }

            drawChart();
            window.addEventListener('resize', drawChart);
        });
    </script>
</body>
</html>

